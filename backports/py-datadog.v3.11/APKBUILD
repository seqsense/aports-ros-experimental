# Contributor: Seiga Kiribayashi <skiribayashi@seqsense.com>
# Maintainer:
pkgname="py-datadog"
_pkgname="datadogpy"
pkgver="0.42.0"
pkgrel=0
pkgdesc="The Datadog Python library"
url="https://github.com/DataDog/datadogpy"
arch="noarch"
license="BSD-3-Clause"
options="!check" # seems broken or need tox which requires too large size of the dependencies
depends="py-requests>=2.6.0"
makedepends="python2 python3 py-setuptools"
checkdepends="pytest py-mock py-freezegun py-psutil"
subpackages="py2-${pkgname#py-}:_py2 py3-${pkgname#py-}:_py3 ${pkgname}-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/DataDog/$_pkgname/archive/v$pkgver.tar.gz"
builddir="$srcdir/$_pkgname-$pkgver"

build() {
	python2 setup.py build
	python3 setup.py build
}

check() {
	python2 -m pytest -v tests/unit
	python3 -m pytest -v tests/unit
}

package() {
	install -D -m 644 LICENSE \
		"$pkgdir"/usr/share/licenses/$pkgname/LICENSE
}

_py() {
	cd "$builddir"
	local python="$1"
	pkgdesc="$pkgdesc (for $python)"
	depends="$depends $python"
	install_if="$pkgname=$pkgver-r$pkgrel $python"

	$python setup.py install --prefix=/usr --root="$subpkgdir"
}

_py2() {
	depends="${depends//py-/py2-}"
	_py python2
}

_py3() {
	depends="${depends//py-/py3-}"
	_py python3
}

sha512sums="4eee789f6582cdee2e39491a141e8716d20bbee68475ad38a8b311481929b4c0996b53ea19636e0988bb554b1a4451ac95eefa4ee3e005726e7da111cb9d4960  py-datadog-0.42.0.tar.gz"
